# New Features in godot-rust 0.4

This guide highlights the new features and capabilities introduced throughout the godot-rust 0.4 release cycle, from 0.3.1 through 0.4.0.

## Table of contents
<!-- toc -->

## Property and export system

[#1214], [#1261], [#1320]: The property system expanded significantly with groups and subgroups export support, `PhantomVar<T>` for properties without backing fields, and enhanced numeric export validation with automatic range inference.

### Groups and subgroups export *(0.3.x)*

Properties can now be grouped to organize them neatly in the Inspector dock, just like in GDScript.

`#[export_group]` and `#[export_subgroup]` are the Rust equivalents of GDScript's `@export_group` and `@export_subgroup` annotations.
While unusual in Rust, they also affect following field**s**, not just one field. We considered alternatives (repetition or struct splitting),
but they come at quite a cost that hinders fast gamedev iteration, and Godot users are likely already familiar with this pattern.

```rs
#[derive(GodotClass)]
#[class(init, base=Node)]
struct MyNode {
    #[export_group(name = "Racer Properties")]
    #[export]
    nickname: GString,
    #[export]
    age: i64,

    #[export_group(name = "Car Properties")]
    #[export_subgroup(name = "Car prints", prefix = "car_")]
    #[export]
    car_label: GString,
    #[export]
    car_number: i64,

    #[export_subgroup(name = "Wheels/Front", prefix = "front_wheel")]
    #[export]
    front_wheel_strength: i64,
    #[export]
    front_wheel_mobility: i64,
    
    #[export_subgroup(name = "Wheels/Rear", prefix = "rear_wheel_")]
    #[export]
    rear_wheel_strength: i64,
    #[export]
    rear_wheel_mobility: i64,

    #[export_subgroup(name = "Wheels", prefix = "wheel_")]
    #[export]
    wheel_material: OnEditor<Gd<PhysicsMaterial>>,
    #[export]
    other_car_properties: GString,

    // Use empty group name to break out from the group:
    #[export_group(name = "")]
    #[export]
    ungrouped_field: GString,
}
```

### Computed properties *(0.3.x)*

[`PhantomVar<T>`][api-phantomvar] enables properties without backing fields, perfect for computed values or dynamic properties that don't need storage.

### Numeric export validation

Numeric export validation now automatically infers reasonable ranges for integer types and validates export range literals against field types at compile time.

[#1214]: https://github.com/godot-rust/gdext/pull/1214
[#1261]: https://github.com/godot-rust/gdext/pull/1261
[#1320]: https://github.com/godot-rust/gdext/pull/1320

[api-phantomvar]: https://godot-rust.github.io/docs/gdext/master/godot/obj/struct.PhantomVar.html

## Callable system evolution

[#1223], [#1327], [#1332], [#1344], [#1346]: The callable system evolved with object-linked callables for automatic cleanup (by **Yarwin**), the transition from `apply_deferred()` to `run_deferred()` and `run_deferred_gd()`, and type-safe return types replacing manual `Variant` conversion.

### Linked callables *(0.3.x)*

Making sure that given Callable feed to the Godot stays alive as long as an Object it is loosely bound to no longer requires goldberg-esque machinery. `Gd::linked_callable` allows to create Callable which stays valid as long as its linked object â€“ ready to be used with any abstraction provided by Godot, be it `call_deferred`, `tweens` or servers callbacks.

```rs
// With call_deferred:
let callable = my_node.linked_callable("No longer valid", |_args| {
    godot_print!("I won't be called, I promised!")
});
let scene_tree = my_node.get_tree().unwrap();
my_node.queue_free();
godot::task::spawn(async move {
   let _ = scene_tree.signals().physics_frame().to_future().await;
    callable.call_deferred(&[]);
    godot_print!("I've heard nothing!");
});

// With tweens:
let callable = self.to_gd().linked_callable("deactivate", move |_args| {
    RenderingServer::singleton().canvas_item_set_visible(cell, false);
});
tween.tween_callback(&callable);
```

### Type-safe deferred calls *(0.3.x)*

Type-safe `call_deferred` alternative provides compile-time guarantees for deferred method calls, eliminating string-based method names and runtime errors.

### Deferred execution methods

The new [`run_deferred()`][api-gd-rundeferred] and [`run_deferred_gd()`][api-gd-rundeferredgd] methods replace `apply_deferred()` with clearer separation between `&mut T` and `Gd<T>` receivers.

### Type-safe return types

Modern callable constructors like [`from_fn()`][api-callable-fromfn] support any return type implementing `ToGodot`, eliminating manual `Variant` conversion boilerplate.

[#1223]: https://github.com/godot-rust/gdext/pull/1223
[#1327]: https://github.com/godot-rust/gdext/pull/1327
[#1332]: https://github.com/godot-rust/gdext/pull/1332
[#1344]: https://github.com/godot-rust/gdext/pull/1344
[#1346]: https://github.com/godot-rust/gdext/pull/1346

[api-gd-rundeferred]: https://godot-rust.github.io/docs/gdext/master/godot/obj/struct.Gd.html#method.run_deferred
[api-gd-rundeferredgd]: https://godot-rust.github.io/docs/gdext/master/godot/obj/struct.Gd.html#method.run_deferred_gd
[api-callable-fromfn]: https://godot-rust.github.io/docs/gdext/master/godot/builtin/struct.Callable.html#method.from_fn

## Enhanced signal system

[#1198], [#1223], [#1288]: Signal handling received comprehensive improvements with type-safe signal disconnection, automatic disconnection through object-linked callables (by **Yarwin**), and typed-to-untyped signal conversion.

### Type-safe disconnection *(0.3.x)*

```rust
// Type-safe disconnection.
my_signal.disconnect(receiver, callable);
```

### Auto-disconnection *(0.3.x)*

```rust
// Auto-disconnection via linked callables - no manual cleanup needed.
let callable = Callable::from_linked_fn(obj, |args| { /* ... */ });
```

### Signal conversion

```rust
// Convert typed signals to untyped when needed.
let untyped = my_typed_signal.to_untyped();
```

[#1198]: https://github.com/godot-rust/gdext/pull/1198
[#1223]: https://github.com/godot-rust/gdext/pull/1223
[#1288]: https://github.com/godot-rust/gdext/pull/1288

[api-typedsignal-tountyped]: https://godot-rust.github.io/docs/gdext/master/godot/obj/struct.TypedSignal.html#method.to_untyped

## Ergonomics and developer experience

[#1225], [#1232], [#1291], [#1300], [#1304], [#1315]: This release cycle introduced numerous features to make Rust-Godot development smoother and more intuitive. The `match_class!` macro enables elegant runtime class dispatching, generic `PackedArray<T>` unifies array handling, and enhanced type safety converts integer parameters to proper enums throughout the engine API.

### Class dispatching *(0.3.x)*

The [`match_class!`][api-matchclass] macro simplifies subclass dispatching with support for mutable bindings, optional fallback branches, and discard patterns:

```rust
match_class!(node; Control => c, Label => mut l, _ @ Node => {
    // Handle any other Node subclass.
});
```

### Enum and bitfield introspection *(0.3.x)*

Programmatic access to all enum and bitfield values enables runtime introspection of Godot's type system.

```rust
// Access all enum constants.
let constants = MyEnum::all_constants();
let values = MyEnum::values(); // Distinct values only.

// Useful for building UI dropdowns.
for (name, value) in constants {
    add_option(name, value);
}
```

### Generic packed arrays

Generic [`PackedArray<T>`][api-packedarray] abstracts over all specific packed array types, enabling code reuse across different array variants:

```rust
fn format_packed_array<T: PackedArrayElement>(array: &PackedArray<T>) -> String {
    // ...
}
```

### Negative indexing

The [`SignedRange`][api-signedrange] type provides type-safe negative indexing for arrays and strings, while [`ElementType`][api-elementtype] exposes type information for generic programming with arrays and dictionaries.

### Engine API type safety

Engine APIs became more type-safe through systematic conversion of integer parameters to proper enum types, catching errors at compile time rather than runtime.

[#1225]: https://github.com/godot-rust/gdext/pull/1225
[#1232]: https://github.com/godot-rust/gdext/pull/1232
[#1291]: https://github.com/godot-rust/gdext/pull/1291
[#1300]: https://github.com/godot-rust/gdext/pull/1300
[#1304]: https://github.com/godot-rust/gdext/pull/1304
[#1315]: https://github.com/godot-rust/gdext/pull/1315

[api-matchclass]: https://godot-rust.github.io/docs/gdext/master/godot/meta/macro.match_class.html
[api-packedarray]: https://godot-rust.github.io/docs/gdext/master/godot/builtin/struct.PackedArray.html
[api-signedrange]: https://godot-rust.github.io/docs/gdext/master/godot/builtin/struct.SignedRange.html
[api-elementtype]: https://godot-rust.github.io/docs/gdext/master/godot/meta/trait.ElementType.html

## Object lifecycle and initialization

[#1211], [#1273], [#1325]: Object initialization and lifecycle management gained powerful new capabilities with `POSTINITIALIZE` notification emission, base pointer access during initialization, and the new `Singleton` trait for generic singleton access.

### Base pointer access *(0.3.x)*

`#[func(gd_self)]` can be now used with various lifecycle methods allowing to precisely control when given instance is bound:

```rs
#[func(gd_self)]
fn ready(this: Gd<Self>) {
    this.signals().call_me_back_maybe().emit(&this);
}
```

### Post-initialization notification

[`POSTINITIALIZE`] notification is now emitted after `init()` completes, providing a hook for setup that requires a fully initialized object.

### Generic singleton access

The [`Singleton`][api-singleton] trait enables generic programming with singletons while maintaining backward compatibility with existing `singleton()` methods.

[#1211]: https://github.com/godot-rust/gdext/pull/1211
[#1273]: https://github.com/godot-rust/gdext/pull/1273
[#1325]: https://github.com/godot-rust/gdext/pull/1325

[api-base-toinitgd]: https://godot-rust.github.io/docs/gdext/master/godot/obj/struct.Base.html#method.to_init_gd
[api-singleton]: https://godot-rust.github.io/docs/gdext/master/godot/obj/trait.Singleton.html

## Advanced argument passing and type conversion

[#1285], [#1308], [#1310], [#1314], [#1323]: The argument passing system received a comprehensive overhaul with the new `ToGodot::Pass` design, automatic `AsArg` implementations, and unified object argument handling. For detailed migration information, see the [v0.4 migration guide](https://godot-rust.github.io/book/migrate/v0.4.html).

The system now uses explicit `ByValue` or `ByRef` passing modes, eliminates the need for manual `AsArg` implementations, and supports optional object parameters through `AsArg<Option<DynGd>>`.

[#1285]: https://github.com/godot-rust/gdext/pull/1285
[#1308]: https://github.com/godot-rust/gdext/pull/1308
[#1310]: https://github.com/godot-rust/gdext/pull/1310
[#1314]: https://github.com/godot-rust/gdext/pull/1314
[#1323]: https://github.com/godot-rust/gdext/pull/1323

## Conclusion

The 0.4 release cycle represents a significant evolution in godot-rust's capabilities, with major improvements to type safety, performance, and developer experience. These features build upon each other to create a more robust and ergonomic Rust-Godot integration.

For upgrading existing code, consult the [v0.4 migration guide](https://godot-rust.github.io/book/migrate/v0.4.html). For a complete list of changes including bugfixes and internal improvements, see the [changelog in the gdext repository](https://github.com/godot-rust/gdext/blob/master/Changelog.md).